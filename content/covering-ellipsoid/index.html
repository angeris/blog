<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <link rel="stylesheet" href="/libs/katex/katex.min.css">
     
    
    <link rel="stylesheet" href="/css/franklin.css">
    <link rel="stylesheet" href="/css/basic.css">
    <link rel="icon" href="/assets/favicon.png">
     <title>The S-procedure and small covering ellipsoids</title>  
</head>
<body>
    <header>
<div class="blog-name"><a href="/">Longest Path Search</a></div>
<nav>
  <ul>
    <li><a href="https://angeris.github.io">About</a></li>
    <li><a href="https://github.com/angeris">Code</a></li>
    <li><a href="/feed.xml">RSS feed</a></li>
    <li><a href="https://c.xkcd.com/random/comic/">Fun</a></li>
  </ul>
</nav>
</header>

    
    
    <div class="franklin-content">
        <h1>The S-procedure and small covering ellipsoids</h1>
        <p>Posted <strong>2019-06-05</strong></p>
    </div>
    
    <!-- Content appended here -->
    
<div class="franklin-content">
<p><em>Note:</em> This post was inspired by <a href="https://msl.stanford.edu/people/kunal-shah">Kunal Shah</a>&#39;s question that came up at some point during one of our meetings: is there an efficient way of finding an ellipsoid which covers the intersections and unions of a bunch of other ellipsoids?</p>
<p>While this question has been explored <a href="https://pdfs.semanticscholar.org/ab38/565f7957f7ee4980663324b5820b0a018de2.pdf">somewhat</a> <a href="http://www.optimization-online.org/DB_FILE/2018/07/6719.pdf">extensively</a>, the exposition is often more general than necessary and aimed at a relatively mathematical audience. Either way, if you&#39;re interested, both papers are fairly well-written—I highly recommend at least a quick skim&#33;</p>
<h1 id="the_s-procedure"><a href="#the_s-procedure" class="header-anchor">The S-procedure</a></h1>
<p>The <a href="https://en.wikipedia.org/wiki/S-procedure">S-procedure</a> is a well known lemma in control theory that seeks to answer the following question:</p>
<p>Let&#39;s say we have a bunch of quadratic functions \(f_0, f_1, f_2, \dots, f_n : \mathbb{R}^m \to \mathbb{R}\). When is it true that</p>
\[
    f_i(x) \le 0 ~~ \text{for $i=1, \dots, n$} \implies  f_0(x) \le 0,
\]
<p>for \(x \in \mathbb{R}^m\)? &#40;Recall that a quadratic is a function of the form \(f(x) = x^TPx + 2q^Tx + r\) for symmetric \(P \in \mathbb{R}^{m\times m}\), \(q \in \mathbb{R}^m\), and \(r \in \mathbb{R}\)&#41;.</p>
<p>There are many reasons to attempt to answer this &#40;surprisingly useful&#41; question. The original motivations were to show <a href="https://stanford.edu/class/ee363/lectures/lmi-s-proc.pdf">stability of systems</a>, though the domain of applications is certainly larger. We can use this to show anything from impossibility results &#40;for example, many of the results of <a href="https://arxiv.org/abs/1811.12936">this paper</a> can be recast in terms of the S-procedure&#41; to, well, in our case, the construction of a small covering ellipsoid from a bunch of other ellipsoids, which is itself useful for things like filtering &#40;for localizing drones from noisy measurements for example&#41; along with many other applications.</p>
<p>If you&#39;re familiar with Lagrange duality, this is mostly an equivalent statement—except that this statement is in the special case of quadratics, where you can say a little more than with general functions.</p>
<h2 id="the_n1_case"><a href="#the_n1_case" class="header-anchor">The \(n=1\) case</a></h2>
<p>We can fully and completely answer this question in the case that \(n=1\): there exists a nonnegative number \(\tau \ge 0\) such that</p>
\[
    f_0(x) \le \tau f_1(x)
\]
<p>for all \(x\) if, and only if, \(f_1(x) \le 0 \implies f_0(x) \le 0\).</p>
<p>Why? Well, let say we have a \(\tau\ge 0\) that satisfies the above inequality. Then, if we have an \(x\) such that \(f_1(x) \le 0\), then</p>
\[
f_0(x) \le \tau f_1(x) \le \tau0 = 0.
\]
<p>The converse is slightly trickier, so I will defer to <a href="http://web.stanford.edu/~boyd/cvxbook/bv_cvxbook.pdf">B&amp;V&#39;s <em>Convex Optimization</em></a> which has a very readable presentation of the proof &#40;see B.1 and B.2 in the appendix&#41;.</p>
<h2 id="the_general_case"><a href="#the_general_case" class="header-anchor">The general case</a></h2>
<p>The general case is really only a slight change from the \(n=1\) case &#40;except that the converse of the statement is not true&#41;. In particular, if there exist \(\lambda \ge 0\) such that</p>
\[
    f_0(x) \le \sum_i \lambda_i f_i(x) ~~ \text{for all $x \in \mathbb{R}^m$},
\]
<p>then, \(f_i(x) \le 0 ~ \text{for} ~ i = 1, \dots, n \implies f_0(x) \le 0\). Showing this is nearly the same as the \(n=1\) case,</p>
\[
f_0(x) \le \sum_i \lambda_i f_i(x) \le \sum_i \lambda_i 0 = 0.
\]
<p>So now we have a family of sufficient &#40;but not necessary&#33;&#41; conditions for which we know when \(f_i(x) \le 0 ~ \text{for} ~ i = 1, \dots, n\) implies that \(f_0(x) \le 0\).</p>
<h1 id="covering_ellipsoids_for_unions"><a href="#covering_ellipsoids_for_unions" class="header-anchor">Covering ellipsoids for unions</a></h1>
<h2 id="definitions_and_connections"><a href="#definitions_and_connections" class="header-anchor">Definitions and connections</a></h2>
<p>Ellipsoids are a particularly nice family to work with since, as you may have guessed, they are the sets defined by</p>
\[
\mathcal{E} = \{x \mid f(x) \le 0\},
\]
<p>where \(f: \mathbb{R}^m \to \mathbb{R}\) is a convex quadratic. This definition gives us a way of translating statements about sets &#40;inclusion, etc&#41; into statements about the functions which generate them. In particular, if we have two ellipsoids \(\mathcal{E}, \mathcal{E}_0 \subseteq \mathbb{R}^n\) defined by the convex quadratics \(f, f_0\), then</p>
\[
\mathcal{E} \subseteq \mathcal{E}_0 \iff (f(x) \le 0 \implies f_0(x) \le 0).
\]
<p>But wait a minute, we know exactly when this happens&#33; By the previous section, we found that</p>
\[
f(x) \le 0 \implies f_0(x) \le 0,
\]
<p>if and only if there is some \(\tau \ge 0\) with \(f_0(x) \le \tau f(x)\). Also note that if we have a union of a bunch of ellipsoids &#40;say \(\mathcal{E}_1, \dots, \mathcal{E}_m\)&#41; that we want to cover with an ellipsoid \(\mathcal{E}_0\), then this is the same as saying</p>
\[
\mathcal{E}_i \subseteq \mathcal{E}_0, ~\text{for $i=1, \dots, m$},
\]
<p>or, that each ellipsoid is covered by the big one, \(\mathcal{E}_0\).</p>
<h2 id="back_to_our_goal"><a href="#back_to_our_goal" class="header-anchor">Back to our goal</a></h2>
<p>Ok, to reiterate, we are looking for a small ellipsoid \(\mathcal{E}_0 = \{x \mid f_0(x) \le 0\}\) such that \(\mathcal{E}_0\) contains all of the other ellipsoids \(\mathcal{E}_i = \{x \mid f_i(x) \le 0\}\), where the \(f_i\) and \(f_0\) are convex quadratics. In other words, using the results of the previous subsection, we look for a quadratic \(f_0\) such that</p>
\[
(f_i(x) \le 0 \implies f_0(x) \le 0) ~~ \text{for each $i$}
\]
<p>which we know happens only when there exists some \(\tau_i \ge 0\) with</p>
\[
f_0(x) \le \tau f_i(x) ~~ \text{for each $i$ and all $x$}.
\]
<p>Now remains the final question: given two quadratics, \(f_i\) and \(f_0\) and some number \(\tau \ge 0\), how can we check if \(f_0(x) \le \tau f_i(x)\) for all \(x\)? I won&#39;t prove this &#40;though I have written a quick proof of this statement in my notes, found <a href="/notes/lmi-iff-quadratic-inequality.pdf">here</a>&#41;, but, if we let \(f_i(x) = x^TP_ix + 2q_i^Tx + r_i\) and \(f_0(x) = x^TP'x + 2(q')^Tx + r'\) then \(f_0(x) \le f_i(x)\) for all \(x\) if, <em>and only if</em>,</p>
\[
\begin{bmatrix}
P' & q\\
(q')^T & r'
\end{bmatrix} \le \tau\begin{bmatrix}
P_i & q_i\\
q_i^T & r_i
\end{bmatrix},
\]
<p>where we say two symmetric matrices \(A, B\) satisfy \(A \le B\) whenever \(x^TAx \le x^TBx\) for all \(x\). A straightforward exercise it to verify that the set of matrices \(A \ge 0\) is a convex cone &#40;almost universally called the positive semidefinite or PSD cone&#41;.</p>
<p>This rewriting is extremely useful, since we&#39;ve turned a problem over a potentially difficult-to-handle space &#40;the space of quadratics greater than or equal to another&#41; into a problem that is easy to handle &#40;the PSD cone&#41;. The best news, though, is that we have efficient algorithms to solve optimization problems whose constraints are PSD constraints.<sup id="fnref:lmibook"><a href="#fndef:lmibook" class="fnref">[1]</a></sup></p>
<h2 id="corresponding_optimization_problem"><a href="#corresponding_optimization_problem" class="header-anchor">Corresponding optimization problem</a></h2>
<p>Finally, after enough background, we can get to the final goal: writing an efficiently-solvable optimization problem to give us a small bounding ellipsoid.</p>
<p>There are several ways of defining &quot;small,&quot; in the case of ellipsoids, but one of the most common definitions is to pick the ellipsoid with the smallest volume. In the case that \(\mathcal{E}_0 = \{x \mid x^TP'x + 2(q')^Tx + r \le 0\}\), the <em>volume</em> of this ellipsoid is given by the determinant, \(\mathop{\mathrm{det}} P'\), of the matrix \(P'\). So, we can write—using the conditions given above—an optimization problem corresponding to finding the smallest &#40;in volume&#41; ellipsoid \(\mathcal{E}_0\) which contains all ellipsoids, \(\mathcal{E}_i\) as</p>
\[
\begin{aligned}
& \underset{P', q', r', \tau}{\mathrm{minimize}}
& & \mathop{\mathrm{det}} P'  \\
& \text{subject to}
& & \begin{bmatrix}
P' & q\\
(q')^T & r'
\end{bmatrix} \le \tau_i\begin{bmatrix}
P_i & q_i\\
q_i^T & r_i
\end{bmatrix}, \quad i = 1, \dots, n.
\end{aligned}
\]
<p>The only problem here &#40;which we can easily fix&#41; is that the determinant is not a convex function. On the other hand, the <em>log</em> determinant <em>is</em> &#40;for a proof, see the <a href="https://web.stanford.edu/~boyd/cvxbook/">Convex book</a>, section 3.1.5&#41;, so we can write,</p>
\[
\begin{aligned}
& \underset{P', q', r', \tau}{\mathrm{minimize}}
& & \log \mathop{\mathrm{det}} P'  \\
& \text{subject to}
& & \begin{bmatrix}
P' & q\\
(q')^T & r'
\end{bmatrix} \le \tau_i\begin{bmatrix}
P_i & q_i\\
q_i^T & r_i
\end{bmatrix}, \quad i = 1, \dots, n.
\end{aligned}
\]
<p>This is equivalent to the original problem since \(\log(y)\) is an increasing function of \(y\). </p>
<p>Of course, any convex function &#40;such as, for example the trace&#41; would do here as well.</p>
<h1 id="covering_ellipsoids_for_intersections_and_unions"><a href="#covering_ellipsoids_for_intersections_and_unions" class="header-anchor">Covering ellipsoids for intersections and unions</a></h1>
<p>Ok, now we know how to solve the problem where we have a bunch of ellipsoids and we want to find an ellipsoid which covers all of them. How about the problem where we want to find an ellipsoid which also covers the sets \(\{N_i\}\) for \(i=1, \dots, k\), which are, themselves, intersections of ellipsoids?</p>
<p>In particular, if \(N_i\) is defined as</p>
\[
N_i = \bigcap_{j \in I_i} \mathcal{E}_j,
\]
<p>for some index set \(I_i \subseteq \{1, \dots, n\}\) and some set of ellipsoids \(\{\mathcal{E}_j\}\), each of which are defined as before &#40;\(\mathcal{E}_j = \{x \mid f_j(x) \le 0 \}\)&#41;, we can perform a similar trick to the one above&#33;</p>
<p>More generally, if we have an ellipsoid \(\mathcal{E}_0 = \{x \mid f_0(x) \le 0\}\), then</p>
\[
N_i \subseteq \mathcal{E}_0 \iff (f_j(x) \le 0 ~~ \text{for $j \in I_i$} \implies f_0(x) \le 0).
\]
<p>&#40;It&#39;s a worthwhile exercise to think about why, but it follows the same idea as before.&#41; In other words, \(\mathcal{E}_0\) is a superset of \(N_i\) only when <em>a bunch of quadratic inequalities imply another</em>. &#40;Where have we seen this before...?&#41;</p>
<p>In other words, we know that &#40;by the first section&#41;, if there exist \(\lambda \ge 0\) such that</p>
\[
f_0(x) \le \sum_{j \in I_i} \lambda_{j} f_j(x),
\]
<p>then we immediately have that \(N_i \subseteq \mathcal{E}_0\). Since the converse is not true, we are sadly not guaranteed to actually find the smallest bounding ellipsoid \(\mathcal{E}_0\), but this is usually quite a good approximation &#40;if it&#39;s not exact&#41;.</p>
<p>Following exactly the same steps as in the previous section and using the same definitions, we now get a new program for minimizing the volume for the union and intersection of ellipsoids:</p>
\[
\begin{aligned}
& \underset{P', q', r', \lambda}{\mathrm{minimize}}
& & \log \mathop{\mathrm{det}} P'  \\
& \text{subject to}
& & \begin{bmatrix}
P' & q\\
(q')^T & r'
\end{bmatrix} \le \sum_{j \in I_i}\lambda_{ij}\begin{bmatrix}
P_j & q_j\\
q_j^T & r_j
\end{bmatrix}, \quad i = 1, \dots, k \\
&&& \lambda_{ij} \ge 0, \quad i=1, \dots, k, ~~ j \in I_i.
\end{aligned}
\]
<p>As before, this program does not guarantee actually finding the minimal volume ellipsoid, but it is likely to be quite close&#33; &#40;That is, if it&#39;s not spot on, most of the time.&#41;</p>
<table class="fndef" id="fndef:lmibook">
    <tr>
        <td class="fndef-backref"><a href="#fnref:lmibook">[1]</a></td>
        <td class="fndef-content">For more information, see Boyd&#39;s <a href="https://web.stanford.edu/~boyd/lmibook/">Linear Matrix Inequalities</a> book.</td>
    </tr>
</table>

<div class="page-foot">
    Built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and <a href="https://julialang.org">Julia</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    
        <script src="/libs/katex/katex.min.js"></script>
<script src="/libs/katex/auto-render.min.js"></script>
<script>renderMathInElement(document.body)</script>

    
    
  </body>
</html>
