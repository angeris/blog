<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <link rel="stylesheet" href="/libs/katex/katex.min.css">
     
    
    <link rel="stylesheet" href="/css/franklin.css">
    <link rel="stylesheet" href="/css/basic.css">
    <link rel="icon" href="/assets/favicon.png">
     <title>Physics, optimization, and impossibility</title>  
</head>
<body>
    <header>
<div class="blog-name"><a href="/">Longest Path Search</a></div>
<nav>
  <ul>
    <li><a href="https://angeris.github.io">About</a></li>
    <li><a href="https://github.com/angeris">Code</a></li>
    <li><a href="/feed.xml">RSS feed</a></li>
    <li><a href="https://c.xkcd.com/random/comic/">Fun</a></li>
  </ul>
</nav>
</header>

    
    
    <div class="franklin-content">
        <h1>Physics, optimization, and impossibility</h1>
        <p>Posted <strong>2018-12-17</strong></p>
    </div>
    
    <!-- Content appended here -->
    
<div class="franklin-content">
<p><em>Note:</em> this post is based on the results of <a href="https://arxiv.org/abs/1811.12936">this arXiv paper</a> which I&#39;ve been working on with Stephen Boyd and Jelena Vuckovic.</p>
<p>The main result of the above paper is kind of weird: essentially, it turns out that you can say what devices are physically <em>impossible</em> by phrasing certain problems as optimization problems and then using some basic tools of optimization to derive lower bounds.</p>
<p>To illustrate: imagine you want to generate an engine which is as efficient as possible, then we know the best you could possibly hope to do is given by the <a href="https://en.wikipedia.org/wiki/Second_law_of_thermodynamics">second law of thermodynamics</a>. Now, what if &#40;and bear with me here&#41; we want something a little weirder? Say, what if we want a heat sink that has a particular dissipation pattern? Or what if you want a photonic crystal that traps light of a given wavelength in some region? Or a horn which has specific resonances?</p>
<p>We can write down the optimization problems corresponding to each of these circumstances: in general, these problems are very hard to solve in ways that aren&#39;t just &quot;try all possible designs and pick the best one.&quot; &#40;And there are a <em>lot</em> of possible designs.&#41; On the other hand, by using some simple heuristics—gradient descent, for example—we appear to give much better devices than what almost anyone can do by hand. This approach, while it appears to work well in practice, brings up a few questions with no obvious answers.</p>
<ol>
<li><p>Maybe there is some design that is really complicated that these heuristics almost always miss, but that is much better than the current ones.</p>
</li>
<li><p>It is possible that the objective we are requesting is physically impossible to achieve and we will never find a good design.</p>
</li>
<li><p>Many heuristics depend heavily on the initial design we provide. Physical intuition sometimes appears to provide good initializations, but often the final design is unintuitive, so perhaps there are better approaches.</p>
</li>
</ol>
<p>The paper provides &#40;some&#41; answers to these questions. In particular, it answers point &#40;2&#41; as its main goal, which gives a partial answer to &#40;1&#41; &#40;namely that the heuristics we use appear to give designs that are often close to the best possible design, at least for the problems we tested&#41;, and an answer to &#40;3&#41;, since the impossibility result suggests an initial design as a byproduct of computing the certificate of impossibility.</p>
<p>I&#39;ll explain the interesting parts of this paper in more detail below, since the paper &#40;for the sake of brevity&#41; simply references the reader to derivations of the results &#40;and leaves some as exercises&#41;.</p>
<h2 id="lagrange_duality"><a href="#lagrange_duality" class="header-anchor">Lagrange duality</a></h2>
<p>In optimization theory, there is a beautiful idea called <em>Lagrange duality</em>, which gives lower bounds to any optimization problem you can write down &#40;at least theoretically speaking&#41;.</p>
<p>Let&#39;s say we have the following optimization problem,</p>
\[
\begin{array}{ll}
\text{minimize} & f(x)\\
\text{subject to} & h(x) \le 0,
\end{array}
\]
<p>&#40;this encompasses essentially every optimization problem ever&#41; with objective function \(f: \mathbb{R}^n \to \mathbb{R}\) and constraint function \(h: \mathbb{R}^n \to \mathbb{R}^m\), where the inequality is taken elementwise. Call the optimal value of the objective of the optimization problem \(p^\star\), which we will see again soon.</p>
<p>Continuing, we can then formulate the <em>Lagrangian</em> of the problem,</p>
\[
\mathcal{L}(x, \lambda) = f(x) + \lambda^Th(x),
\]
<p>with \(\lambda \ge 0\). Finally, we formulate the dual <em>function</em></p>
\[
g(\lambda) = \inf_x \left(f(x) + \lambda^Th(x)\right).
\]
<p>Now, and here&#39;s the magic, this dual function \(g(\lambda)\) at any \(\lambda \ge 0\) is always a lower bound for the optimal objective \(p^\star\). Why? Well,</p>
\[
g(\lambda) = \inf_x \mathcal{L}(x, \lambda),
\]
<p>and, by definition of \(\inf\),</p>
\[
\inf_x \mathcal{L}(x, \lambda) \le \mathcal{L}(x, \lambda),
\]
<p>for every \(x\). Now, every feasible point \(x^\mathrm{feas}\) of the optimization problem satisfies \(h(x) \le 0\) &#40;this is the definition of &#39;feasible&#39;&#41;, so, since \(\lambda \ge 0\),</p>
\[
\mathcal{L}(x^\mathrm{feas}, \lambda) = f(x^\mathrm{feas}) + \underbrace{\lambda^Th(x^\mathrm{feas})}_{\le 0} \le f(x^\mathrm{feas}).
\]
<p>In other words, for any feasible point, \(\mathcal{L}(x^\mathrm{feas}, \lambda)\) is always smaller than the objective value at that point. But, since \(g(\lambda)\) is smaller than \(\mathcal{L}(x, \lambda)\) for <em>any</em> \(x\), not just the feasible ones, we have</p>
\[
g(\lambda) \le f(x^\mathrm{feas}),
\]
<p>for any feasible point. This means that it is also at most as large as the optimal value &#40;since every optimal point of this optimization problem is feasible&#41;. That is,</p>
\[
g(\lambda) \le p^\star.
\]
<p>Therefore, for any \(\lambda\ge 0\), we know that \(g(\lambda)\) is always a lower bound to the optimal objective value&#33;</p>
<p>Of course, sometimes computing \(g(\lambda)\) is at least as difficult as solving the original problem &#40;due to the \(\inf\) we have in the definition of \(g\)&#41;. It just so happens that many physical equations and objectives we care about are of a form elegant enough to give an explicit formula for \(g\), which is the main point of this paper.</p>
<h3 id="best_lower_bound"><a href="#best_lower_bound" class="header-anchor">Best lower bound</a></h3>
<p>Of course, we often want the best &#40;largest&#41; lower bound, not just <em>a</em> lower bound &#40;which can often be quite bad&#41;. In other words, we want to maximize our lower bound. We can phrase this as the new optimization problem,</p>
\[
\begin{array}{ll}
\text{maximize} & g(\lambda)\\
\text{subject to} & \lambda \ge 0.
\end{array}
\]
<p>What is interesting is that this optimization problem is always convex—<em>e.g.</em>, it is almost always easy to compute the optimal value, <em>if</em> we can explicitly write down what \(g\) is. &#40;I won&#39;t prove this here, but the proof is very straightforward. Take a peek at section 5.1.2 in Boyd&#39;s <a href="https://web.stanford.edu/~boyd/cvxbook/"><em>Convex Optimization</em></a>.&#41;</p>
<h2 id="explicit_dual_function_for_g"><a href="#explicit_dual_function_for_g" class="header-anchor">Explicit dual function for \(g\)</a></h2>
<h3 id="problem_formulation"><a href="#problem_formulation" class="header-anchor">Problem formulation</a></h3>
<p>Many of the problems we&#39;re interested in &#40;including design in photonics via Maxwell&#39;s equations,<sup id="fnref:maxwell"><a href="#fndef:maxwell" class="fnref">[1]</a></sup> acoustics via Helmholtz&#39;s equations, quantum mechanics via Schrodinger&#39;s equation, and heat engineering via the heat equation&#41; have physics equations of the form &#40;once discretized&#41;</p>
\[
(A + \mathrm{diag}(\theta))z = b,
\]
<p>where \(\theta \in \mathbb{R}^n\) are the design parameters &#40;<em>e.g.</em> permittivity in the case of photonics, or speed of sound in the material in the case of acoustics&#41; and \(z \in \mathbb{R}^n\) is the field &#40;<em>e.g.</em> the electric field in photonics, or the amplitude of the wave in acoustics&#41;. \(A \in \mathbb{R}^{n\times n}\) is a matrix encoding the physics &#40;the curl of the curl in Maxwell&#39;s equations, or a discretized Laplacian in Helmholtz&#39;s&#41; and \(b \in \mathbb{R}^n\) is an excitation of the field.</p>
<p>More specifically, take a peek at Helmholtz&#39;s equation:</p>
\[
\nabla^2 a(x) + \left(\frac{\omega^2}{c(x)^2}\right)a(x) = u(x),
\]
<p>where \(c: \mathbb{R}^3 \to \mathbb{R}_{> 0}\) is a function specifying the speed of sound at every point in the material, while \(a: \mathbb{R}^3 \to \mathbb{R}\) is a function specifying the amplitude at each point, \(u: \mathbb{R}^3 \to \mathbb{R}\) is a function specifying an excitation, and \(\omega \in \mathbb{R}_{\ge 0}\) is the frequency of the wave. We can make some simple correspondences:</p>
\[
\Bigg(\underbrace{\nabla^2}_{A} + \underbrace{\bigg(\frac{\omega^2}{c(x)^2}\bigg)}_{\mathrm{diag}(\theta)}\Bigg)\underbrace{a(x)}_{z} = \underbrace{u(x)}_{b}.
\]
<p>Now, we usually want the field &#40;\(z\)&#41; to look similar to a desired field &#40;which we will call \(\hat z\)&#41;, while satisfying the physics equation described above. We can phrase this in several ways, but a <a href="/ls-images.html">particularly natural one</a> is by attempting to minimize the objective \(\left\|z - \hat z\right\|_2^2\).</p>
<p>Finally, we are only able to choose materials within a specific range: that is, \(\theta^\mathrm{min} \le \theta \le \theta^\mathrm{max}\).</p>
<p>Putting all of this together, we can write the optimization problem as</p>
\[
\begin{array}{ll}
\text{minimize} & \frac12\left\|z - \hat z\right\|_2^2\\
\text{subject to} & (A + \mathrm{diag}(\theta))z = b\\
& \theta^\mathrm{min} \le \theta \le \theta^\mathrm{max}.
\end{array}
\]
<p>which is exactly problem &#40;1&#41; in the paper, in the special case where \(W = I\), the identity matrix.</p>
<h3 id="deriving_the_dual"><a href="#deriving_the_dual" class="header-anchor">Deriving the dual</a></h3>
<p>Here is essentially the only &#39;magic&#39; part of the paper. First, we can write the Lagrangian of the problem as,</p>
\[
\mathcal{L}(z, \theta, \nu) = \frac12\left\|z - \hat z\right\|_2^2 + \nu^T((A + \mathrm{diag}(\theta))z - b).
\]
<p>Now, there is something weird here: notice that I sneakily dropped the term containing the lower and upper limits for \(\theta\)—this idea is, in fact, what saves the entire approach. What we will first do is the usual thing: we&#39;ll minimize the Lagrangian over all possible \(z\), which we can easily do since the Lagrangian is a convex quadratic over \(z\). In particular, taking the gradient over \(z\) and setting it to zero &#40;which is necessary and sufficient by convexity and differentiability&#41; gives us that the optimal \(z\) is</p>
\[
z = \hat z - (A + \mathrm{diag(\theta)})^T\nu,
\]
<p>which means that</p>
\[
\inf_z \mathcal{L}(z, \theta, \nu) = - \frac12\left\|\hat z - (A + \mathrm{diag(\theta)})^T\nu\right\|_2^2 - \nu^Tb + \frac12\|\hat z\|_2^2.
\]
<p>The next step is then finding the infimum of \(\mathcal{L}\) over \(\theta\). That is, finding</p>
\[
\inf_\theta \left(\inf_z \mathcal{L}(z, \theta, \nu)\right).
\]
<p>Now, of course, minimization over all \(\theta\) is a lower bound &#40;but not a very good one&#41;, since, unless \(\nu = 0\), we can send the whole thing to negative infinity. &#40;Why?&#41;</p>
<p>What we can do instead is minimize over \(\theta\), constrained to its feasible range, \(\theta^\mathrm{min} \le \theta \le \theta^\mathrm{max}\). I&#39;ll leave it as an exercise for the reader as to why this is still a lower bound, but you should ponder this very carefully, because it is the main point of the paper. As an initial hint, take a second look at the proof above for why the Lagrangian is a lower bound in the first place. Of course, a second hint can be found in the paper which gives a somewhat-natural construction &#40;sometimes called the &quot;partial Lagrangian&quot;&#41;, but I highly recommend sitting down with a bit of wine &#40;or something stronger&#41; and thinking about it&#33;<sup id="fnref:wine"><a href="#fndef:wine" class="fnref">[2]</a></sup></p>
<p>If you&#39;ve convinced yourself of this &#40;or haven&#39;t yet, but want to continue&#41;, we now have the following minimization problem:</p>
\[
\begin{aligned}
g(\nu) &= \inf_{\theta^\mathrm{min} \le \theta \le \theta^\mathrm{max}} \left(\inf_z \mathcal{L}(z, \theta, \nu)\right)\\
&= \inf_{\theta^\mathrm{min} \le \theta \le \theta^\mathrm{max}} \left(- \frac12\left\|\hat z - (A + \mathrm{diag(\theta)})^T\nu\right\|_2^2 - \nu^Tb + \frac12\|\hat z\|_2^2\right)
\end{aligned}
\]
<p>The trick is to notice two things. One, that the objective is concave in \(\theta\) and, two, that the objective is <em>separable</em> over each component of \(\theta\). </p>
<p>First off, let&#39;s say a function \(v: \mathbb{R} \to \mathbb{R}\) is concave over the interval \([L, U]\), then it achieves its minimum value at the boundaries of the interval. Why? Well, the definition of concavity says, for every \(0 \le \gamma \le 1\),</p>
\[
v(\gamma L + (1- \gamma)U) \ge \gamma v(L) + (1-\gamma)v(U) \ge \min\{v(L), v(U)\}.
\]
<p>but any point in the interval \([L, U]\) is a convex combination of \(L\) or \(U\)&#33; So every point inside of the interval is at least as large as the smallest endpoint of the interval, which completes the proof.</p>
<p>This solves our problem: since the objective is separable, then we only need to consider each component of \(\theta\), and, because it&#39;s concave, then we know that an optimal \(\theta_i\) is one of either \(\theta^\mathrm{min}_i\) or \(\theta^\mathrm{max}_i\). Replacing the complicated \(\inf\) with this &#40;much simpler&#41; \(\min\) gives the analytic solution for \(g\):</p>
\[
\begin{aligned}
g(\nu) = \sum_i \min\bigg\{-\frac12 (\hat z_i - a_i^T\nu + \theta_i^\mathrm{min} \nu_i)^2, &- \frac12 (\hat z_i - a_i^T\nu + \theta_i^\mathrm{max} \nu_i)^2\bigg\} \\&- \nu^Tb + \frac12\|\hat z\|_2^2,
\end{aligned}
\]
<p>or, writing it in the same way as the paper, by pulling out the \(-1/2\) &#40;and using \(\theta^\mathrm{min} = 0\)&#41;,</p>
\[
g(\nu) = -\frac12 \sum_i \max\bigg\{ (\hat z_i - a_i^T\nu + \nu_i)^2, (\hat z_i - a_i^T\nu + \theta_i^\mathrm{max} \nu_i)^2\bigg\} - \nu^Tb + \frac12\|\hat z\|_2^2.
\]
<p>Now that we have an analytic form for \(g\) &#40;our set of lower bounds&#41;, we can maximize the function to get the best lower bound. As discussed before, this is a convex optimization problem which can be formulated by <a href="https://www.cvxpy.org">CVXPY</a> and solved using one of the many available solvers for <a href="https://osqp.org">convex quadratically-constrained quadratic programs</a> &#40;QCQPs&#41; or <a href="https://www.embotech.com/ECOS">second-order conic programs</a> &#40;SOCPs&#41;.</p>
<h2 id="results"><a href="#results" class="header-anchor">Results</a></h2>
<p>I&#39;ll give a quick summary of the results of the paper, but this is the section I would recommend checking out in the paper itself. &#40;There are pretty pictures&#33;&#41;</p>
<p>For a relatively complex design, we found that a simple, commonly used heuristic finds a design with an objective value lying around 9&#37; above the lower bound, and, therefore has objective value at most 9&#37; above the <em>best possible</em> design. &#40;In general, though, we suspect that the true optimum lies closer to the designs that the heuristics give than the lower bound we come up with.&#41; In other words, it is physically impossible to more-than-marginally improve upon this design.</p>
<p>Additionally &#40;I might discuss how this is done in a later post&#41;, we receive an initial design that is qualitatively quite similar to the final, locally-optimized design. See the image below.</p>
<p>&lt;img src&#61;&quot;/images/physics-impossibility-results/primal-dual-comparison.png&quot; class&#61;&quot;insert&quot; style&#61;&quot;width: 100&#37;&quot;&gt; <em>Comparison between the design suggested by the lower bound and the locally-optimized design.</em></p>
<p>I highly recommend checking out the <a href="https://arxiv.org/abs/1811.12936">pre-print that is up on arXiv</a> for more info. Also, if you spot any mistakes &#40;in either the post or the paper&#41;, please do @ me&#33;</p>
<p><table class="fndef" id="fndef:maxwell">
    <tr>
        <td class="fndef-backref"><a href="#fnref:maxwell">[1]</a></td>
        <td class="fndef-content">This is... almost accurate, but not quite. It turns out a small modification to the problem is needed for Maxwell&#39;s equations in two and three dimensions. For specifics, see the appendix in the paper.</td>
    </tr>
</table>
 <table class="fndef" id="fndef:wine">
    <tr>
        <td class="fndef-backref"><a href="#fnref:wine">[2]</a></td>
        <td class="fndef-content">Honestly, I <em>only</em> recommend reading this blog with wine &#40;or whatever you have at hand&#41;. Not sure it&#39;s bearable, otherwise.</td>
    </tr>
</table>
</p>
<div class="page-foot">
    Built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and <a href="https://julialang.org">Julia</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    
        <script src="/libs/katex/katex.min.js"></script>
<script src="/libs/katex/auto-render.min.js"></script>
<script>renderMathInElement(document.body)</script>

    
    
  </body>
</html>
