<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <link rel="stylesheet" href="/libs/katex/katex.min.css">
     
    
    <link rel="stylesheet" href="/css/franklin.css">
    <link rel="stylesheet" href="/css/basic.css">
    <link rel="icon" href="/assets/favicon.png">
     <title>A note on "Optimal Design of Controlled Environment Agricultural Systems (...)"</title>  
</head>
<body>
    <header>
<div class="blog-name"><a href="/">Longest Path Search</a></div>
<nav>
  <ul>
    <li><a href="https://angeris.github.io">About</a></li>
    <li><a href="https://github.com/angeris">Code</a></li>
    <li><a href="/feed.xml">RSS feed</a></li>
    <li><a href="https://c.xkcd.com/random/comic/">Fun</a></li>
  </ul>
</nav>
</header>

    
    
    <div class="franklin-content">
        <h1>A note on "Optimal Design of Controlled Environment Agricultural Systems (...)"</h1>
        <p>Posted <strong>2021-03-17</strong></p>
    </div>
    
    <!-- Content appended here -->
    
<div class="franklin-content">
<p>This is just a basic note on Cetegen and Stuber&#39;s paper &#40;apologies for the paywall&#41; published a few days ago, <a href="https://www.sciencedirect.com/science/article/pii/S0098135421000636"><em>Optimal Design of Controlled Environment Agricultural Systems Under Market Uncertainty</em></a>. This post &quot;simplifies&quot; problem &#40;4&#41; from a bilevel optimization problem to a single &#40;convex&#41; optimization problem which can be readily solved. As a side note, I only skimmed the references provided, and some were too complicated for me to understand, especially at first glance.<sup id="fnref:wat"><a href="#fndef:wat" class="fnref">[1]</a></sup> It is possible this technique is well known in the specific literature referenced, but hidden under mountains of notation and definitions. I also note that this is not the problem they &#40;approximately&#41; solve, but the method presented here might be useful in that case, too.</p>
<h2 id="the_one_duality_trick_doctors_dont_want_you_to_know"><a href="#the_one_duality_trick_doctors_dont_want_you_to_know" class="header-anchor">The One &#40;Duality&#41; Trick Doctors Don&#39;t Want You To Knowâ„¢</a></h2>
<p>I&#39;ve used this trick before in a few other papers, with the main example being a paper coauthored with Kunal Shah and Mac Schwager, found <a href="https://arxiv.org/abs/1905.12875">here</a>, specifically in equation &#40;8&#41; and below, starting on page 10.</p>
<p>The basic &#40;very general&#33;&#41; idea is to replace a &quot;min-max&quot; optimization problem with a &quot;min&quot; optimization problem. For example, say we are given the following optimization problem</p>
\[
\begin{aligned}
& \text{minimize} && \max_{g(y) \le 0} f(x, y)\\
& \text{subject to} && h(x) \le 0,
\end{aligned}
\]
<p>with variables \(x \in \mathbb{R}^m\) and \(y \in \mathbb{R}^n\) and functions \(f : \mathbb{R}^m \times \mathbb{R}^n \to \mathbb{R}\), \(g:\mathbb{R}^n \to \mathbb{R}\), and \(h: \mathbb{R}^m \to \mathbb{R}\). Now, consider the usual Lagrangian of the &quot;inner problem&quot; &#40;the one with the max over \(y\)&#41;, which we know is</p>
\[
L(x, y,\lambda) = f(x, y) - \lambda g(y).
\]
<p>If we define</p>
\[
\bar f(x, \lambda) = \sup_{y} L(x, y, \lambda),
\]
<p>then, for any \(\lambda \ge 0\) and any feasible \(y\) &#40;<em>i.e.</em>, \(y\) that satisfies \(g(y) \le 0\)&#41;, we have that</p>
\[
\bar f(x, \lambda) \ge L(x, y, \lambda) = f(x, y) - \lambda g(y) \ge f(x, y).
\]
<p>&#40;The first inequality follows from the definition of \(\sup\) while the last inequality follows since \(\lambda \ge 0\) and \(g(y) \le 0\) which means that \(\lambda g(y) \le 0\).&#41; So, for any \(x\), we know that, if you give me any \(\lambda \ge 0\), then \(\bar f(x, \lambda)\) is an &quot;overestimator&quot; of \(f(x, y)\) for any feasible \(y\). </p>
<p>But, since this is true for any \(\lambda \ge 0\) and \(x\), then certainly</p>
\[
\inf_{\lambda \ge 0} f(x, \lambda) \ge \sup_{g(y) \le 0} f(x, y),
\]
<p>for any \(x\).<sup id="fnref:weakduality"><a href="#fndef:weakduality" class="fnref">[2]</a></sup></p>
<p>If we use our new overestimator \(\bar f\) instead of \(f\), our new problem is now a simple optimization problem</p>
\[
\begin{aligned}
& \text{minimize} && \bar f(x, \lambda)\\
& \text{subject to} && h(x) \le 0\\
&&& \lambda \ge 0,
\end{aligned}
\]
<p>that is not in min-max form and requires no other special techniques to solve. The optimal value of this problem need not be the same as that of the original, but is always guaranteed to be at least as large.</p>
<p>Of course, this <em>can</em> help, but it certainly doesn&#39;t solve our problem. We just need one more piece to the puzzle&#33;</p>
<h3 id="the_hammer"><a href="#the_hammer" class="header-anchor">The hammer</a></h3>
<p>If you&#39;ve studied a bit of convex analysis the punchline is this: the inequality we have for \(f\) and \(\bar f\) above holds exactly at equality when \(f\) is concave in \(y\) and \(g\) is convex in \(y\). More specifically</p>
\[
\inf_{\lambda \ge 0} \bar f(x, \lambda) = \sup_{g(y) \le 0} f(x, y),
\]
<p>for any \(x\).<sup id="fnref:strongduality"><a href="#fndef:strongduality" class="fnref">[3]</a></sup></p>
<p>When this is true, the new problem has the same optimal value as the original and any solution \(x\) for the original is a solution to the new problem&#33; &#40;Why?&#41;</p>
<p>I won&#39;t cover more since the specifics don&#39;t matter too much, but the general idea is simple enough, and we now have all the parts to convert the min-max problem &#40;4&#41; of Cetegen and Stuber to a simple convex optimization problem.</p>
<h3 id="the_new_and_shiny_problem"><a href="#the_new_and_shiny_problem" class="header-anchor">The &#40;new and shiny&#41; problem</a></h3>
<p>Things are mostly algebra from here on out, so apologies in advance, I guess. I will leave much of the &quot;hard&quot; work to the reader :&#41;</p>
<p>The complete problem &#40;4&#41; is, as written in the paper, using &#40;mostly&#41; their notation:</p>
\[
\begin{aligned}
    & \text{minimize} && \max_{M \in \mathcal{M}} x^TMx \\
    & \text{subject to} && r^Tx \ge r_\mathrm{min}\\
    &&& 1^Tx = 1\\
    &&& 0 \le x \le 1,
\end{aligned}
\]
<p>with variable \(x \in \mathbb{R}^n\), where \(r\) is some vector of returns &#40;but the specifics don&#39;t matter&#41; and \(\mathcal{M}\) is:</p>
\[
\mathcal{M} = \{M \ge 0 \mid M^-_{ij} \le M_{ij} \le M^+_{ij}, ~~ i, j=1, \dots, n\}.
\]
<p>In other words, \(\mathcal{M}\) is the set of positive semidefinite matrices &#40;\(M \ge 0\)&#41; whose entries lie between those of \(M^-\) and \(M^+\). I&#39;ve also dropped some constant terms in the objective since those don&#39;t change the problem.</p>
<p>In this case, the &quot;inner&quot; optimization problem is the one in the objective, which is just</p>
\[
\begin{aligned}
    & \text{maximize} && x^TMx \\
    & \text{subject to} && M^-_{ij} \le M_{ij} \le M^+_{ij}, ~~ i, j=1, \dots, n\\
    &&& M \ge 0,
\end{aligned}
\]
<p>with variable \(M \in \mathbb{R}^{n\times n}\). We can easily write a &#40;slightly not canonical&#41; Lagrangian:</p>
\[
L(x, M, \Lambda^+, \Lambda^-) = x^TMx - \mathrm{tr}(\Lambda^+(M - M^+)) + \mathrm{tr}(\Lambda^-(M - M^-)),
\]
<p>where \(\Lambda^+, \Lambda^- \in \mathbb{R}^{n\times n}_+\) are elementwise nonnegative. &#40;The Lagrangian is non-canonical because I have not included the constraint \(M \ge 0\), which we will enforce below.&#41; It is not hard to show that</p>
\[
\sup_{M \ge 0} L(x, M, \Lambda^+, \Lambda^-) = \begin{cases}
    \mathrm{tr}(\Lambda^+M^+) - \mathrm{tr}(\Lambda^-M^-) & xx^T \le \Lambda^+ - \Lambda^-\\
    + \infty & \text{otherwise}.
\end{cases}
\]
<p>As before, the inequality between matrices is with respect to the semidefinite cone.</p>
<p>Plugging this back into the original problem formulation, we now have a convex optimization problem:</p>
\[
\begin{aligned}
    & \text{minimize} &&  \mathrm{tr}(\Lambda^+M^+) - \mathrm{tr}(\Lambda^-M^-)\\
    & \text{subject to} && r^Tx \ge r_\mathrm{min}\\
    &&& xx^T \le \Lambda^+ - \Lambda^-\\
    &&& 1^Tx = 1\\
    &&& 0 \le x \le 1\\
    &&& \Lambda^+_{ij}, \Lambda^-_{ij} \ge 0, \quad i,j =1, \dots, n.
\end{aligned}
\]
<p>The &#40;extra&#33;&#41; variables \(\Lambda^+, \Lambda^- \in \mathbb{R}^{n\times n}\) are included along with the original variable \(x \in \mathbb{R}^n\), and the same problem data as before. This problem, by use of the Schur complement applied to the semidefinite inequality, is easily recast into standard SDP form and can be solved by most standard convex optimization problem solvers, such as <a href="https://github.com/cvxgrp/scs">SCS</a> or <a href="https://www.mosek.com">Mosek</a>.</p>
<p>Quick edit &#40;3/18/22&#41;: Thanks to <a href="https://twitter.com/bodonoghue85">bodonoghue85</a> for <a href="https://twitter.com/bodonoghue85/status/1372634252924358662">finding a typo</a>&#33;</p>
<p><table class="fndef" id="fndef:wat">
    <tr>
        <td class="fndef-backref"><a href="#fnref:wat">[1]</a></td>
        <td class="fndef-content">See, <em>e.g.</em> page 429 of <a href="https://aiche.onlinelibrary.wiley.com/doi/epdf/10.1002/aic.690290312">this paper</a>, where they seem to re-prove basic things like &quot;the supremum of a bunch of convex functions is convex,&quot; and &quot;partial minimization of a convex function is convex,&quot; but I&#39;m honestly not 100&#37; sure.</td>
    </tr>
</table>
 <table class="fndef" id="fndef:weakduality">
    <tr>
        <td class="fndef-backref"><a href="#fnref:weakduality">[2]</a></td>
        <td class="fndef-content">This is called <em>weak duality</em>, <em>c.f.</em> sections 5.1.3 and 5.2.2 of <a href="https://web.stanford.edu/~boyd/cvxbook/">Convex Optimization</a>.</td>
    </tr>
</table>
 <table class="fndef" id="fndef:strongduality">
    <tr>
        <td class="fndef-backref"><a href="#fnref:strongduality">[3]</a></td>
        <td class="fndef-content">This is often referred to as <em>strong duality</em>, <em>c.f.</em> section 5.3.2 of <a href="https://web.stanford.edu/~boyd/cvxbook/">Convex Optimization</a>. There are some additional conditions for equality to hold, but these are almost always met in practice.</td>
    </tr>
</table>
</p>
<div class="page-foot">
    Built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and <a href="https://julialang.org">Julia</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    
        <script src="/libs/katex/katex.min.js"></script>
<script src="/libs/katex/auto-render.min.js"></script>
<script>renderMathInElement(document.body)</script>

    
    
  </body>
</html>
